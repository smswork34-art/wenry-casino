<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | Wenry Casino</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        h1 {
            font-size: 24px;
            color: #00d4ff;
            text-align: center;
            flex-grow: 1;
        }
        
        .admin-badge {
            background: linear-gradient(90deg, #ff6b35, #ff4d00);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(0, 212, 255, 0.1);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: #00d4ff;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
            background: linear-gradient(90deg, #00d4ff, #0088ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            color: #aaa;
            font-size: 14px;
        }
        
        /* –ó–∞—è–≤–∫–∏ */
        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(0, 212, 255, 0.1);
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: #00ff88;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .deposit-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #00d4ff;
        }
        
        .deposit-item.pending {
            border-left-color: #ffcc00;
            animation: pulse 2s infinite;
        }
        
        .deposit-item.completed {
            border-left-color: #00ff88;
        }
        
        .deposit-item.rejected {
            border-left-color: #ff5555;
        }
        
        .deposit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .deposit-user {
            font-weight: bold;
            font-size: 16px;
        }
        
        .deposit-amount {
            background: linear-gradient(90deg, #00b09b, #96c93d);
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .deposit-details {
            color: #aaa;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .deposit-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-accept {
            background: linear-gradient(90deg, #00b09b, #96c93d);
            color: white;
            flex: 1;
        }
        
        .btn-reject {
            background: rgba(255, 85, 85, 0.2);
            color: #ff5555;
            border: 1px solid #ff5555;
            flex: 1;
        }
        
        .btn-refresh {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            border: 1px solid #00d4ff;
            padding: 8px 20px;
        }
        
        /* –ö–æ—à–µ–ª—å–∫–∏ */
        .wallets-list {
            display: grid;
            gap: 10px;
        }
        
        .wallet-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .wallet-address {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 6px;
            word-break: break-all;
            font-size: 12px;
        }
        
        .wallet-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-active {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .status-inactive {
            background: rgba(255, 85, 85, 0.2);
            color: #ff5555;
        }
        
        /* –ò—Å—Ç–æ—Ä–∏—è */
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .transaction-info {
            flex: 1;
        }
        
        .transaction-type {
            font-weight: bold;
        }
        
        .transaction-date {
            color: #aaa;
            font-size: 12px;
        }
        
        .transaction-amount {
            font-weight: bold;
        }
        
        .amount-positive {
            color: #00ff88;
        }
        
        .amount-negative {
            color: #ff5555;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            border: 2px solid #00d4ff;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-title {
            color: #00d4ff;
            margin-bottom: 20px;
            text-align: center;
            font-size: 20px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #00d4ff, #0088ff);
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid #aaa;
        }
        
        /* –ê–ª–µ—Ä—Ç—ã */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            background: #00b894;
            color: white;
            font-weight: bold;
            z-index: 1001;
            animation: slideIn 0.3s ease;
            display: none;
            max-width: 300px;
        }
        
        .alert.error {
            background: #ff5555;
        }
        
        .alert.warning {
            background: #ffcc00;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #aaa;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            color: #00d4ff;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .nav-label {
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <button class="back-btn" onclick="window.location.href='index.html'">
                ‚Üê –ù–∞–∑–∞–¥
            </button>
            <h1>üëë –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨</h1>
            <div class="admin-badge">ADMIN</div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-grid" id="statsGrid">
            <!-- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>
        
        <!-- –ó–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ -->
        <div class="section">
            <div class="section-title">
                <span>üí∞ –ó–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</span>
                <button class="btn btn-refresh" onclick="loadDeposits()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div id="depositsList">
                <!-- –ó–∞—è–≤–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                <div style="text-align: center; color: #aaa; padding: 20px;">
                    –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫...
                </div>
            </div>
        </div>
        
        <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
        <div class="section">
            <div class="section-title">
                <span>üë• –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span>
                <button class="btn btn-refresh" onclick="loadUsers()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div id="usersList">
                <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
        
        <!-- –ö–æ—à–µ–ª—å–∫–∏ -->
        <div class="section">
            <div class="section-title">
                <span>üè¶ –ö–æ—à–µ–ª—å–∫–∏ USDT</span>
                <button class="btn btn-refresh" onclick="loadWallets()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>
            <div class="wallets-list" id="walletsList">
                <!-- –ö–æ—à–µ–ª—å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
        
        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ -->
        <div class="section">
            <div class="section-title">
                <span>üìä –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</span>
            </div>
            <div id="transactionsList">
                <!-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
        
        <!-- –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏ -->
        <div class="section" style="text-align: center;">
            <button class="btn btn-primary" onclick="addTestUser()" style="margin: 5px;">
                üë§ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç-—é–∑–µ—Ä–∞
            </button>
            <button class="btn btn-secondary" onclick="resetAllBalances()" style="margin: 5px;">
                üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –±–∞–ª–∞–Ω—Å—ã
            </button>
            <button class="btn btn-secondary" onclick="showAddWalletModal()" style="margin: 5px;">
                ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ—à–µ–ª–µ–∫
            </button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-title" id="confirmTitle">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</div>
            <div id="confirmMessage"></div>
            <div class="modal-buttons">
                <button class="modal-btn btn-primary" onclick="confirmAction()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button class="modal-btn btn-secondary" onclick="closeModal('confirmModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ -->
    <div class="modal" id="addWalletModal">
        <div class="modal-content">
            <div class="modal-title">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ—à–µ–ª–µ–∫ USDT</div>
            <div style="margin-bottom: 20px;">
                <input type="text" id="walletAddress" placeholder="–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: TYFgXbE1HMYp4Jeh1VoiYjqGoeZVLoxF9R)" 
                       style="width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(0,212,255,0.3); background: rgba(255,255,255,0.1); color: white; margin-bottom: 15px;">
                <input type="text" id="walletNetwork" placeholder="–°–µ—Ç—å (TRC20, ERC20)" value="TRC20"
                       style="width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(0,212,255,0.3); background: rgba(255,255,255,0.1); color: white; margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 15px;">
                    <input type="checkbox" id="walletActive" checked> –ê–∫—Ç–∏–≤–Ω—ã–π –∫–æ—à–µ–ª–µ–∫
                </label>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn btn-primary" onclick="addNewWallet()">–î–æ–±–∞–≤–∏—Ç—å</button>
                <button class="modal-btn btn-secondary" onclick="closeModal('addWalletModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ -->
    <div class="modal" id="rejectModal">
        <div class="modal-content">
            <div class="modal-title">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞—è–≤–∫—É</div>
            <div style="margin-bottom: 20px;">
                <textarea id="rejectReason" placeholder="–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è..." 
                          style="width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(255,85,85,0.3); background: rgba(255,255,255,0.1); color: white; min-height: 100px;"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn btn-primary" onclick="processReject()">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                <button class="modal-btn btn-secondary" onclick="closeModal('rejectModal')">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    
    <!-- –ê–ª–µ—Ä—Ç—ã -->
    <div class="alert" id="alert"></div>
    
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="bottom-nav">
        <a href="index.html" class="nav-item">
            <div class="nav-icon">üéÆ</div>
            <div class="nav-label">–ò–≥—Ä—ã</div>
        </a>
        <a href="admin.html" class="nav-item active">
            <div class="nav-icon">üëë</div>
            <div class="nav-label">–ê–¥–º–∏–Ω</div>
        </a>
        <a href="profile.html" class="nav-item">
            <div class="nav-icon">üë§</div>
            <div class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</div>
        </a>
        <a href="history.html" class="nav-item">
            <div class="nav-icon">üìú</div>
            <div class="nav-label">–ò—Å—Ç–æ—Ä–∏—è</div>
        </a>
    </div>
    
    <script>
        let supabaseClient = null;
        let currentUser = null;
        let selectedDepositId = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–¥–º–∏–Ω –ª–∏ —ç—Ç–æ
            const tg = window.Telegram?.WebApp;
            if (!tg) {
                alert('–û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ Telegram');
                return;
            }
            
            const tgUser = tg.initDataUnsafe?.user;
            if (!tgUser) {
                alert('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                return;
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
            try {
                const { createClient } = window.supabase;
                supabaseClient = createClient(
                    window.SUPABASE_CONFIG.url,
                    window.SUPABASE_CONFIG.key
                );
                console.log('‚úÖ Supabase –ø–æ–¥–∫–ª—é—á–µ–Ω');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ Supabase:', error);
                showAlert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ', 'error');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–¥–º–∏–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            currentUser = tgUser;
            const isAdmin = await checkIfAdmin(tgUser.id);
            
            if (!isAdmin) {
                showAlert('‚õî –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', 'error');
                setTimeout(() => window.location.href = 'index.html', 2000);
                return;
            }
            
            console.log('‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä:', tgUser.username);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            await loadAllData();
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                loadDeposits();
                updateStats();
            }, 30000);
            
            console.log('‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≥–æ—Ç–æ–≤–∞');
        });
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        async function checkIfAdmin(userId) {
            try {
                // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - –µ—Å–ª–∏ ID —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∞–¥–º–∏–Ω—Å–∫–∏–º ID –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
                return userId.toString() === window.SUPABASE_CONFIG.adminId.toString();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤:', error);
                return false;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        async function loadAllData() {
            await updateStats();
            await loadDeposits();
            await loadUsers();
            await loadWallets();
            await loadTransactions();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function updateStats() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const [usersCount, pendingCount, totalDeposits, activeWallets] = await Promise.all([
                    getTotalUsers(),
                    getPendingDepositsCount(),
                    getTotalDeposits(),
                    getActiveWalletsCount()
                ]);
                
                const statsHTML = `
                    <div class="stat-card">
                        <div class="stat-label">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        <div class="stat-value">${usersCount}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üí∞ –û–∂–∏–¥–∞–µ—Ç</div>
                        <div class="stat-value">${pendingCount}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üíé –ü–æ–ø–æ–ª–Ω–µ–Ω–æ</div>
                        <div class="stat-value">${totalDeposits.toFixed(2)}</div>
                        <div class="stat-label">USDT</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">üè¶ –ö–æ—à–µ–ª—å–∫–∏</div>
                        <div class="stat-value">${activeWallets}</div>
                        <div class="stat-label">–∞–∫—Ç–∏–≤–Ω—ã—Ö</div>
                    </div>
                `;
                
                document.getElementById('statsGrid').innerHTML = statsHTML;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫
        async function loadDeposits() {
            try {
                const { data: deposits, error } = await supabaseClient
                    .from('deposit_requests')
                    .select(`
                        *,
                        users!inner(username)
                    `)
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                if (error) throw error;
                
                if (!deposits || deposits.length === 0) {
                    document.getElementById('depositsList').innerHTML = `
                        <div style="text-align: center; color: #aaa; padding: 20px;">
                            üì≠ –ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
                        </div>
                    `;
                    return;
                }
                
                let depositsHTML = '';
                
                deposits.forEach(deposit => {
                    const statusClass = deposit.status;
                    const user = deposit.users || {};
                    const username = user.username || `ID: ${deposit.user_id}`;
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                    const date = new Date(deposit.created_at);
                    const dateStr = date.toLocaleDateString('ru-RU');
                    const timeStr = date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                    
                    depositsHTML += `
                        <div class="deposit-item ${statusClass}">
                            <div class="deposit-header">
                                <div class="deposit-user">üë§ ${username}</div>
                                <div class="deposit-amount">${deposit.amount} USDT</div>
                            </div>
                            <div class="deposit-details">
                                üìç –ö–æ—à–µ–ª–µ–∫: <code>${deposit.wallet_address.substring(0, 20)}...</code><br>
                                üìù TX: ${deposit.tx_hash ? `<code>${deposit.tx_hash.substring(0, 20)}...</code>` : '–ù–µ —É–∫–∞–∑–∞–Ω'}<br>
                                ‚è∞ ${dateStr} ${timeStr}<br>
                                üìã –°—Ç–∞—Ç—É—Å: <strong>${getStatusText(deposit.status)}</strong>
                            </div>
                            ${deposit.status === 'pending' ? `
                            <div class="deposit-actions">
                                <button class="btn btn-accept" onclick="acceptDeposit('${deposit.id}')">
                                    ‚úÖ –ü—Ä–∏–Ω—è—Ç—å
                                </button>
                                <button class="btn btn-reject" onclick="showRejectModal('${deposit.id}')">
                                    ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                                </button>
                            </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                document.getElementById('depositsList').innerHTML = depositsHTML;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫:', error);
                document.getElementById('depositsList').innerHTML = `
                    <div style="text-align: center; color: #ff5555; padding: 20px;">
                        ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫
                    </div>
                `;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadUsers() {
            try {
                const { data: users, error } = await supabaseClient
                    .from('users')
                    .select('id, username, balance, created_at')
                    .order('created_at', { ascending: false })
                    .limit(15);
                
                if (error) throw error;
                
                if (!users || users.length === 0) {
                    document.getElementById('usersList').innerHTML = `
                        <div style="text-align: center; color: #aaa; padding: 20px;">
                            üì≠ –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                        </div>
                    `;
                    return;
                }
                
                let usersHTML = '';
                
                users.forEach(user => {
                    const date = new Date(user.created_at);
                    const dateStr = date.toLocaleDateString('ru-RU');
                    
                    usersHTML += `
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div class="transaction-type">üë§ ${user.username || `ID: ${user.id}`}</div>
                                <div class="transaction-date">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: ${dateStr}</div>
                            </div>
                            <div class="transaction-amount amount-positive">
                                ${user.balance || 0} ‚ÇΩ
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('usersList').innerHTML = usersHTML;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–æ–≤
        async function loadWallets() {
            try {
                const { data: wallets, error } = await supabaseClient
                    .from('payment_wallets')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                if (!wallets || wallets.length === 0) {
                    document.getElementById('walletsList').innerHTML = `
                        <div style="text-align: center; color: #aaa; padding: 20px;">
                            üè¶ –ù–µ—Ç –∫–æ—à–µ–ª—å–∫–æ–≤
                        </div>
                    `;
                    return;
                }
                
                let walletsHTML = '';
                
                wallets.forEach(wallet => {
                    walletsHTML += `
                        <div class="wallet-item">
                            <div class="wallet-address">${wallet.wallet_address}</div>
                            <div class="wallet-status ${wallet.is_active ? 'status-active' : 'status-inactive'}">
                                ${wallet.is_active ? '‚úÖ –ê–∫—Ç–∏–≤–µ–Ω' : '‚ùå –ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('walletsList').innerHTML = walletsHTML;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—à–µ–ª—å–∫–æ–≤:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
        async function loadTransactions() {
            try {
                const { data: transactions, error } = await supabaseClient
                    .from('transactions')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(20);
                
                if (error) throw error;
                
                if (!transactions || transactions.length === 0) {
                    document.getElementById('transactionsList').innerHTML = `
                        <div style="text-align: center; color: #aaa; padding: 20px;">
                            üìú –ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
                        </div>
                    `;
                    return;
                }
                
                let transactionsHTML = '';
                
                transactions.forEach(trans => {
                    const date = new Date(trans.created_at);
                    const dateStr = date.toLocaleDateString('ru-RU');
                    const timeStr = date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
                    
                    const isPositive = trans.type === 'win' || trans.type === 'deposit';
                    const typeText = getTransactionTypeText(trans.type);
                    
                    transactionsHTML += `
                        <div class="transaction-item">
                            <div class="transaction-info">
                                <div class="transaction-type">${typeText}</div>
                                <div class="transaction-date">${dateStr} ${timeStr} | User: ${trans.user_id.substring(0, 8)}...</div>
                            </div>
                            <div class="transaction-amount ${isPositive ? 'amount-positive' : 'amount-negative'}">
                                ${isPositive ? '+' : '-'}${trans.amount} ‚ÇΩ
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('transactionsList').innerHTML = transactionsHTML;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:', error);
            }
        }
        
        // –ü—Ä–∏–Ω—è—Ç—å –∑–∞—è–≤–∫—É
        async function acceptDeposit(depositId) {
            if (!confirm('–ü—Ä–∏–Ω—è—Ç—å —ç—Ç—É –∑–∞—è–≤–∫—É –∏ –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?')) {
                return;
            }
            
            try {
                // –ü–æ–ª—É—á–∞–µ–º –∑–∞—è–≤–∫—É
                const { data: deposit, error: depositError } = await supabaseClient
                    .from('deposit_requests')
                    .select('*, users!inner(*)')
                    .eq('id', depositId)
                    .single();
                
                if (depositError) throw depositError;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏
                const { error: updateError } = await supabaseClient
                    .from('deposit_requests')
                    .update({
                        status: 'completed',
                        updated_at: new Date().toISOString(),
                        admin_note: `–ü—Ä–∏–Ω—è—Ç–æ –∞–¥–º–∏–Ω–æ–º ${currentUser.id}`
                    })
                    .eq('id', depositId);
                
                if (updateError) throw updateError;
                
                // –ü–æ–ø–æ–ª–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const newBalance = (deposit.users.balance || 0) + deposit.amount * 100;
                
                const { error: balanceError } = await supabaseClient
                    .from('users')
                    .update({ 
                        balance: newBalance,
                        last_seen: new Date().toISOString()
                    })
                    .eq('id', deposit.user_id);
                
                if (balanceError) throw balanceError;
                
                // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                await supabaseClient
                    .from('transactions')
                    .insert({
                        user_id: deposit.user_id,
                        type: 'deposit',
                        amount: deposit.amount * 100,
                        status: 'completed',
                        description: `USDT –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ #${depositId}`
                    });
                
                showAlert(`‚úÖ –ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${deposit.amount * 100} ‚ÇΩ`, 'success');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadDeposits();
                await updateStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞—è–≤–∫–∏:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞—è–≤–∫–∏', 'error');
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
        function showRejectModal(depositId) {
            selectedDepositId = depositId;
            document.getElementById('rejectReason').value = '';
            showModal('rejectModal');
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
        async function processReject() {
            const reason = document.getElementById('rejectReason').value.trim();
            
            if (!reason) {
                showAlert('–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è', 'error');
                return;
            }
            
            try {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞—è–≤–∫—É
                const { error } = await supabaseClient
                    .from('deposit_requests')
                    .update({
                        status: 'rejected',
                        updated_at: new Date().toISOString(),
                        admin_note: `–û—Ç–∫–ª–æ–Ω–µ–Ω–æ: ${reason}`
                    })
                    .eq('id', selectedDepositId);
                
                if (error) throw error;
                
                showAlert('‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞', 'success');
                closeModal('rejectModal');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                await loadDeposits();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏', 'error');
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
        function showAddWalletModal() {
            document.getElementById('walletAddress').value = '';
            document.getElementById('walletNetwork').value = 'TRC20';
            document.getElementById('walletActive').checked = true;
            showModal('addWalletModal');
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ—à–µ–ª–µ–∫
        async function addNewWallet() {
            const address = document.getElementById('walletAddress').value.trim();
            const network = document.getElementById('walletNetwork').value.trim();
            const isActive = document.getElementById('walletActive').checked;
            
            if (!address || !network) {
                showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('payment_wallets')
                    .insert({
                        wallet_address: address,
                        network: network,
                        currency: 'USDT',
                        is_active: isActive,
                        created_at: new Date().toISOString()
                    });
                
                if (error) throw error;
                
                showAlert('‚úÖ –ö–æ—à–µ–ª–µ–∫ –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
                closeModal('addWalletModal');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ—à–µ–ª—å–∫–æ–≤
                await loadWallets();
                await updateStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ—à–µ–ª—å–∫–∞', 'error');
            }
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function addTestUser() {
            const testId = Math.floor(Math.random() * 1000000);
            const username = `testuser_${testId}`;
            
            try {
                const { error } = await supabaseClient
                    .from('users')
                    .insert({
                        id: testId,
                        username: username,
                        balance: 1000,
                        created_at: new Date().toISOString(),
                        last_seen: new Date().toISOString()
                    });
                
                if (error) throw error;
                
                showAlert(`‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${username} –¥–æ–±–∞–≤–ª–µ–Ω`, 'success');
                await loadUsers();
                await updateStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞', 'error');
            }
        }
        
        // –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –±–∞–ª–∞–Ω—Å—ã
        async function resetAllBalances() {
            if (!confirm('‚ö†Ô∏è –°–±—Ä–æ—Å–∏—Ç—å –í–°–ï –±–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ 0? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) {
                return;
            }
            
            try {
                const { error } = await supabaseClient
                    .from('users')
                    .update({ balance: 0 });
                
                if (error) throw error;
                
                showAlert('‚úÖ –í—Å–µ –±–∞–ª–∞–Ω—Å—ã —Å–±—Ä–æ—à–µ–Ω—ã –∫ 0', 'success');
                await loadUsers();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞ –±–∞–ª–∞–Ω—Å–æ–≤:', error);
                showAlert('‚ùå –û—à–∏–±–∫–∞', 'error');
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        async function getTotalUsers() {
            const { count, error } = await supabaseClient
                .from('users')
                .select('*', { count: 'exact', head: true });
            
            return error ? 0 : count;
        }
        
        async function getPendingDepositsCount() {
            const { count, error } = await supabaseClient
                .from('deposit_requests')
                .select('*', { count: 'exact', head: true })
                .eq('status', 'pending');
            
            return error ? 0 : count;
        }
        
        async function getTotalDeposits() {
            const { data, error } = await supabaseClient
                .from('deposit_requests')
                .select('amount')
                .eq('status', 'completed');
            
            if (error) return 0;
            return data.reduce((sum, d) => sum + (d.amount || 0), 0);
        }
        
        async function getActiveWalletsCount() {
            const { count, error } = await supabaseClient
                .from('payment_wallets')
                .select('*', { count: 'exact', head: true })
                .eq('is_active', true);
            
            return error ? 0 : count;
        }
        
        function getStatusText(status) {
            const statuses = {
                'pending': '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ',
                'completed': '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ',
                'rejected': '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'
            };
            return statuses[status] || status;
        }
        
        function getTransactionTypeText(type) {
            const types = {
                'deposit': 'üíé –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ',
                'withdraw': 'üì§ –í—ã–≤–æ–¥',
                'bet': 'üé∞ –°—Ç–∞–≤–∫–∞',
                'win': 'üí∞ –í—ã–∏–≥—Ä—ã—à'
            };
            return types[type] || type;
        }
        
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function showAlert(message, type = 'success') {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert ${type}`;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    alert.style.display = 'none';
                    alert.style.animation = '';
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
